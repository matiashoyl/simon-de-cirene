<div class="span3">
  <ul class="nav nav-tabs nav-stacked sesions-sidenav affix">
    <% @cursos.each do |curso| %>
      <% if curso.id == @curso.id %>
        <li class="active">
          <a href="#">
            <i class="icon-chevron-right pull-right"></i>
            <%= curso.nombre %>
          </a>
        </li>
      <% else %>
        <li>
          <a href="/cursos/<%=curso.id%>">
            <i class="icon-chevron-right pull-right"></i>
            <%= curso.nombre %>
          </a>
        </li>
      <% end %>
    <% end %>
  </ul>
</div>
<div class="span1"></div>
<div class="span8">
  <%= render 'layouts/messages' %>
  <%# ------------------------------ Header ------------------------------ %> 
  <div class="page-header">
    <h1><%= @curso.nombre %> <small><%= @curso.codigo %>, Programa <%= Programa.find(@curso.programa_id).nombre %></small></h1>
  </div>
	<%# ------------------------------ Sesiones ------------------------------ %> 
	<h3>Sesiones</h3>
  <% if @sesiones.any? %>
    <table class="table table-condensed table-striped">
      <thead>
        <tr>
          <th>#</th>
          <th>Tema</th>
          <th>Relator</th>
          <th>Fecha</th>
          <th>Asistentes</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <% contador = 1 %>
        <% @sesiones.each do |sesion| %>
          <% if @curso.alumnos.empty? %>
            <tr>
          <% elsif sesion.porcentaje_asistentes == "NA" %>
            <tr class="warning">
          <% elsif sesion.porcentaje_asistentes < 85 %>
            <tr class="error">
          <% else %>
            <tr class="success">
          <% end %>
            <td><%= contador %></td>
            <td><%= sesion.tema %></td>
            <td><%= User.find(sesion.user_id).name %></td>
            <td><%= sesion.fecha.strftime("%d %b, %Y") %></td>
            <td>
              <% if sesion.porcentaje_asistentes == "NA" %>
              NA
              <% else %>
                <%= sesion.porcentaje_asistentes %>%
              <% end %>
            </td>
            <td>
              <div class="btn-group">
                <%= link_to("Detalles", details_path(sesion), :class => 'btn btn-mini') %>
                <a data-toggle="modal" href="#edit-sesion-<%= sesion.id %>" class="btn btn-mini" type="button">Editar</a>
                <a data-toggle="modal" href="#delete-sesion-<%= sesion.id %>" class="btn btn-mini btn-inverse" type="button">Eliminar</a>
              </div>
            </td>
          </tr>
          <%= render :partial => 'sesion', :locals => {:sesion => sesion} %>
          <%= render :partial => 'eliminar_sesion', :locals => {:sesion => sesion} %>
          <% contador = contador + 1 %>
        <% end %>
      </tbody>
    </table>
  	<% else %>
    <p>El curso todavía no tiene sesiones programadas</p>
  	<% end %>
	  <a data-toggle="modal" href="#new-sesion" class="btn btn-mini btn-info" type="button">Agregar Sesión</a>
  	<%= render 'new_sesion' %>
    <hr>
    <%# ------------------------------ Alumnos ------------------------------ %> 
    <h3>Alumnos</h3>
    <% if @alumnos.any? %>
      <table class="table table-condensed table-striped">
        <thead>
            <tr>
              <th></th>
              <% contador = 1 %>
              <% @sesiones.each do |sesion| %>
                <th><%= contador %></th>
                <% contador = contador +1 %>
              <% end %>
              <th>Asistencia</th>
            </tr>
        </thead>
        <tbody>
          <% @alumnos.each do |alumno| %>
            <% if alumno.porcentaje_asistencia(@curso) == "NA" %>
              <tr class="warning">
            <% elsif alumno.porcentaje_asistencia(@curso) < 75 %>
              <tr class="error">
            <% else %>
              <tr class="success">
            <% end %>
              <td><%= alumno.nombre %> <%= alumno.apellido_paterno %></td>
              <% @sesiones.each do |sesion| %>
                <td>
                  <% if alumno_sesion = AlumnoSesion.where(:alumno_id => alumno, :sesion_id => sesion).first %>
                    <% if alumno_sesion.presente %>
                      <p>P</p>
                    <% else %>
                      <p>A</p>
                    <% end %>
                  <% else %>
                    <p>NA</p>
                  <% end %>
                </td>
              <% end %>
              <td>
                <% if alumno.porcentaje_asistencia(@curso) == "NA" %>
                  NA
                <% else %>
                  <%= alumno.porcentaje_asistencia(@curso) %>%
                <% end %>  
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
      <%= link_to "Descargar Excel", alumno_path(@curso, format: "xls"), :class => 'btn btn-mini btn-success' %>
    <% else %>
    <p>El curso todavía no tiene alumnos</p>
    <% end %>
</div>
